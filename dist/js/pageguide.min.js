/*! pageguide 2016-01-29 */
tl=window.tl||{},tl.pg=tl.pg||{},tl.pg.pageGuideList=tl.pg.pageGuideList||[],tl.pg.interval={},function(a){tl.pg.default_prefs={auto_show_first:!0,loading_selector:"#loading",track_events_cb:function(){},handle_doc_switch:null,custom_open_button:null,pg_caption:"page guide",tourtitle:"Open Page Guide for help",check_welcome_dismissed:function(){var a="tlypageguide_welcome_shown_"+tl.pg.hashUrl();try{if(localStorage.getItem(a))return!0}catch(b){if(document.cookie.indexOf(a)>-1)return!0}return!1},dismiss_welcome:function(){var a="tlypageguide_welcome_shown_"+tl.pg.hashUrl();try{localStorage.setItem(a,!0)}catch(b){var c=new Date;c.setDate(c.getDate()+365),document.cookie=a+"=true; expires="+c.toUTCString()}},ready_callback:null,pointer_fallback:!0,default_zindex:100,steps_element:"#tlyPageGuide",auto_refresh:!1,refresh_welcome:!1,refresh_interval:500},tl.pg.wrapper_markup='<div id="tlyPageGuideWrapper"><div id="tlyPageGuideOverlay"></div><div id="tlyPageGuideMessages"><a href="#" class="tlypageguide_close" title="Close Guide">close</a><span class="tlypageguide_index"></span><div class="tlypageguide_text"></div><a href="#" class="tlypageguide_back" title="Previous">Previous</a><a href="#" class="tlypageguide_fwd" title="Next">Next</a></div><div id="tlyPageGuideContent"></div><div id="tlyPageGuideToggles"></div></div>',tl.pg.toggle_markup='<div class="tlypageguide_toggle" title="Launch Page Guide"><div><span class="tlypageguide_toggletitle"></span></div><a href="#" class="tlypageguide_close" title="close guide">close guide &raquo;</a></div>',tl.pg.init=function(b){b=a.extend({},tl.pg.default_prefs,b);var c=a(b.steps_element),d=tl.pg.hashCode(b.steps_element);if(clearInterval(tl.pg.interval[d]),0!==c.length){b.pointer_fallback&&tl.pg.pointerEventSupport()&&(b.pointer_fallback=!1);var e=a("#tlyPageGuideWrapper"),f=!0;if(e.length||(f=!1,e=a(tl.pg.wrapper_markup)),null==b.custom_open_button&&a("#tlyPageGuideToggle"+d).length<1){var g=c.data("tourtitle")||b.tourtitle,h=a(tl.pg.toggle_markup).attr("id","tlyPageGuideToggle"+d).prepend(b.pg_caption);h.find(".tlypageguide_toggletitle").text(g),e.find("#tlyPageGuideToggles").append(h)}f||a("body").prepend(e);var i=new tl.pg.PageGuide(a("#tlyPageGuideWrapper"),b);return i.ready(function(){i.setup_welcome(),i.preferences.welcome_refresh&&i.updateTimer(function(){i.setup_welcome()},"welcome"),i.setup_handlers(),i.$base.find(".tlypageguide_toggle").animate({right:"-120px"},250),"function"==typeof b.ready_callback&&b.ready_callback()}),tl.pg.pageGuideList.push(i),i}},tl.pg.PageGuide=function(b,c){this.preferences=c,this.$base=b,this.$message=this.$base.find("#tlyPageGuideMessages"),this.$fwd=this.$base.find("a.tlypageguide_fwd"),this.$back=this.$base.find("a.tlypageguide_back"),this.$content=this.$base.find("#tlyPageGuideContent"),this.$steps=a(c.steps_element),this.uuid=tl.pg.hashCode(c.steps_element),this.$toggle=this.$base.find("#tlyPageGuideToggle"+this.uuid),this.cur_idx=0,this.cur_selector=null,this.track_event=this.preferences.track_events_cb,this.handle_doc_switch=this.preferences.handle_doc_switch,this.custom_open_button=this.preferences.custom_open_button,this.is_open=!1,this.targetData={},this.hashTable={},this.changeQueue=[],this.visibleTargets=[],this.timer={overlay:null,welcome:null}},tl.pg.hashUrl=function(){return tl.pg.hashCode(window.location.href)},tl.pg.hashCode=function(a){var b,c,d=0;if(null==a||0===a.length)return d;for(b=0;b<a.length;b++)c=a.charCodeAt(b),d=(d<<5)-d+c,d&=d;return d.toString()},tl.pg.getTargetInfo=function(a){var b=[];return""===a.split("iframe-")[0]?b=a.split("iframe-")[1].split("-"):b.push(a),b},tl.pg.getIframeContents=function(b){var c;return a.isArray(b)?c=a(b[0]):iframe=a(tl.pg.getTargetInfo(b)[0]),iframe.contents()},tl.pg.isScrolledIntoView=function(b,c){var d=a(window).scrollTop(),e=d+a(window).height(),f=a(b).offset().top,g=f+a(b).height();return f>=d&&e-c>=g},tl.pg.iframedElIsScrolledIntoView=function(b,c,d){b=a(b).contents();var e=b.find("body").scrollTop();return dvbtm=e+b.height(),eltop=b.find(c).offset().top,elbtm=eltop+b.find(c).height(),eltop>=e&&elbtm<=dvbtm-d},tl.pg.destroy=function(){a("#tlyPageGuideWrapper").remove(),a("body").removeClass("tlypageguide-open"),a("body").removeClass("tlyPageGuideWelcomeOpen");for(var b in tl.pg.interval)tl.pg.interval.hasOwnProperty(b)&&clearInterval(tl.pg.interval[b])},tl.pg.pointerEventSupport=function(){var a=document.createElement("x"),b=document.documentElement,c=window.getComputedStyle,d=null;return"pointerEvents"in a.style?(a.style.pointerEvents="auto",a.style.pointerEvents="x",b.appendChild(a),d=c&&"auto"===c(a,"").pointerEvents,b.removeChild(a),!!d):!1},tl.pg.closeOpenGuides=function(a){for(var b=0;b<tl.pg.pageGuideList.length;b++)tl.pg.pageGuideList[b].uuid!==a&&tl.pg.pageGuideList[b].close()},tl.pg.PageGuide.prototype.setup_welcome=function(){var b=a(".tlyPageGuideWelcome, #tlyPageGuideWelcome").not("#tlyPageGuideWrapper > .tlyPageGuideWelcome, #tlyPageGuideWrapper > #tlyPageGuideWelcome").eq(0),c=this;b.length>0&&(c.preferences.show_welcome=!c.preferences.check_welcome_dismissed(),c.preferences.show_welcome&&b.appendTo(c.$base),b.find(".tlypageguide_ignore").length&&b.on("click",".tlypageguide_ignore",function(){c.close_welcome(),c.track_event("PG.ignoreWelcome")}),b.find(".tlypageguide_dismiss").length&&b.on("click",".tlypageguide_dismiss",function(){c.close_welcome(),c.preferences.dismiss_welcome(),c.track_event("PG.dismissWelcome")}),b.on("click",".tlypageguide_start",function(){c.open(),c.track_event("PG.startFromWelcome")}),c.preferences.show_welcome&&c.pop_welcome())},tl.pg.PageGuide.prototype.ready=function(b){var c=this;return tl.pg.interval[c.uuid]=window.setInterval(function(){a(c.preferences.loading_selector).is(":visible")||(b(),clearInterval(tl.pg.interval[c.uuid]))},250),this},tl.pg.PageGuide.prototype.addSteps=function(){var b=this;b.$steps.find("li").each(function(c,d){var e=a(d),f=e.data("tourtarget"),g=e.attr("class"),h=a(f).is("iframe"),i=b.$content;if(h&&(f="iframe-"+f+"-"+e.data("tourtargetFrame"),i=tl.pg.getIframeContents(f).find("body")),null==b.targetData[f]){b.targetData[f]={targetStyle:{},content:e.html()};var j=tl.pg.hashCode(f)+"";b.hashTable[j]=f,i.append('<div class="tlypageguide_shadow tlypageguide_shadow'+j+'" data-selectorhash="'+j+'"><span class="tlyPageGuideStepIndex '+g+'"></span></div>')}})},tl.pg.PageGuide.prototype.checkTargets=function(){var b=this,c=0,d=[];for(var e in b.targetData){var f,g,h=tl.pg.getTargetInfo(e);f=1===h.length?a(h[0]):tl.pg.getIframeContents(e).find(h[1]);for(var i={targetStyle:{display:"none"}},j=0;j<f.length;j++)if(a(f[j]).is(":visible")){g=a(f[j]),i.targetStyle.display="block";var k=g.offset();a.extend(i.targetStyle,{top:k.top,left:k.left,width:g.outerWidth(),height:g.outerHeight(),"z-index":g.css("z-index")}),c++,i.index=c,d.push(e);break}var l={target:e};for(var m in i.targetStyle)i.targetStyle[m]!==b.targetData[e][m]&&(null==l.targetStyle&&(l.targetStyle={}),l.targetStyle[m]=i.targetStyle[m]);i.index!==b.targetData[e].index&&(l.index=i.index),(null!=l.targetStyle||null!=l.index)&&b.changeQueue.push(l),a.extend(b.targetData[e],i)}b.visibleTargets=d},tl.pg.PageGuide.prototype.positionOverlays=function(){for(var b=0;b<this.changeQueue.length;b++){var c=this.changeQueue[b],d=".tlypageguide_shadow"+tl.pg.hashCode(c.target),e=tl.pg.getTargetInfo(c.target),f=this.$content.find(d);if(e.length>1&&(f=tl.pg.getIframeContents(e).find(d)),null!=c.targetStyle){var g=a.extend({},c.targetStyle);for(var h in g)"z-index"===h&&(g[h]="number"==typeof g[h]?g[h]+1:this.preferences.default_zindex);f.css(g)}null!=c.index&&f.find(".tlyPageGuideStepIndex").text(c.index)}this.changeQueue=[]},tl.pg.PageGuide.prototype.refreshVisibleSteps=function(){this.addSteps(),this.checkTargets(),this.positionOverlays()},tl.pg.PageGuide.prototype.updateVisible=function(){if(this.refreshVisibleSteps(),null!=this.cur_selector&&this.cur_selector!==this.visibleTargets[this.cur_idx]){var a=this.cur_idx%this.visibleTargets.length;this.show_message(a)}},tl.pg.PageGuide.prototype.show_message=function(b){var c=this.visibleTargets[b],d=this.targetData[c],e=tl.pg.getTargetInfo(c);if(null!=d){var f=".tlypageguide_shadow"+tl.pg.hashCode(c);if(this.handle_doc_switch){var g=this.visibleTargets.length,h=this.visibleTargets[(b-1+g)%g];this.handle_doc_switch(c,h)}var i=this.$content;tl.pg.getTargetInfo(c).length>1&&(i=tl.pg.getIframeContents(c)),i.find(".tlypageguide-active").removeClass("tlypageguide-active"),i.find(f).addClass("tlypageguide-active"),this.$message.find(".tlypageguide_text").html(d.content),this.cur_idx=b,this.cur_selector=c;var j=100,k=parseFloat(this.$message.css("height"));this.$message.css("height","auto");var l=parseFloat(this.$message.outerHeight());this.$message.css("height",k),j>l&&(l=j),l>a(window).height()/2&&(l=a(window).height()/2),this.$message.show().animate({height:l},500);var m;if(e.length>1?(m=tl.pg.isScrolledIntoView(a(e[0])),tl.pg.iframedElIsScrolledIntoView(e[0],e[1],this.$message.outerHeight())||tl.pg.getIframeContents(e).find("html, body").animate({scrollTop:d.targetStyle.top-50},500)):m=tl.pg.isScrolledIntoView(a(c)),this.$message.outerHeight()){var n;n=e.length>1?a(e[0]).offset().top-50:d.targetStyle.top-50,a("html,body").animate({scrollTop:n},500)}this.roll_number(this.$message.find("span"),d.index)}},tl.pg.PageGuide.prototype.navigateBack=function(){var a=(this.cur_idx+this.visibleTargets.length-1)%this.visibleTargets.length;return this.track_event("PG.back"),this.show_message(a,!0),!1},tl.pg.PageGuide.prototype.navigateForward=function(){var a=(this.cur_idx+1)%this.visibleTargets.length;return this.track_event("PG.fwd"),this.show_message(a,!0),!1},tl.pg.PageGuide.prototype.open=function(){this.is_open||(tl.pg.closeOpenGuides(this.uuid),this._open())},tl.pg.PageGuide.prototype._open=function(){this.preferences.show_welcome&&(this.preferences.dismiss_welcome(),this.close_welcome()),this.is_open=!0,this.track_event("PG.open"),this.refreshVisibleSteps(),this.preferences.auto_show_first&&this.visibleTargets.length&&this.show_message(0),a("body").addClass("tlypageguide-open"),this.$toggle.addClass("tlyPageGuideToggleActive");var b=this;b.preferences.auto_refresh&&b.updateTimer(function(){b.updateVisible()},"overlay")},tl.pg.PageGuide.prototype.updateTimer=function(a,b){var c=this;a(),c.timer[b]=setTimeout(function(){c.updateTimer(a,b)},c.preferences.refresh_interval)},tl.pg.PageGuide.prototype.close=function(){this.is_open&&this._close()},tl.pg.PageGuide.prototype._close=function(){this.is_open=!1,this.track_event("PG.close"),this.preferences.auto_refresh&&clearTimeout(this.timer.overlay),this.$content.find(".tlypageguide_shadow").css("display","none"),this.$content.find(".tlypageguide-active").removeClass("tlypageguide-active"),this.$message.animate({height:"0"},500,function(){a(this).hide()}),a("body").removeClass("tlypageguide-open"),this.$toggle.removeClass("tlyPageGuideToggleActive")},tl.pg.PageGuide.prototype.setup_handlers=function(){function b(a){var b=c.hashTable[a.parent().data("selectorhash")],d=c.targetData[b],e=d?d.index:1;c.track_event("PG.specific_elt"),c.show_message(e-1)}var c=this,d=null==c.custom_open_button?c.$base.find("#tlyPageGuideToggle"+c.uuid):a(c.custom_open_button);d.off(),d.on("click",function(){c.is_open?c.close():!c.preferences.show_welcome||c.preferences.check_welcome_dismissed()||a("body").hasClass("tlyPageGuideWelcomeOpen")?c.open():c.pop_welcome()}),a(".tlypageguide_close",c.$message.add(a(".tlypageguide_toggle"))).on("click",function(){return c.close(),!1}),c.$base.on("click",".tlyPageGuideStepIndex",function(){b(a(this))}),a("iframe").contents().on("click",".tlyPageGuideStepIndex",function(){b(a(this))}),c.$fwd.on("click",function(){return c.is_open&&c.navigateForward(),!1}),c.$back.on("click",function(){return c.is_open&&c.navigateBack(),!1}),c.preferences.pointer_fallback&&c.$base.on("click",".tlypageguide_shadow",function(b){a(this).hide();var c=a(document.elementFromPoint(b.clientX,b.clientY));c.is("a")?c.get(0).click():c.trigger(b.type),a(this).show()}),a(window).resize(function(){c.is_open&&c.refreshVisibleSteps()})},tl.pg.PageGuide.prototype.roll_number=function(a,b,c){a.animate({"text-indent":(c?"":"-")+"50px"},"fast",function(){a.html(b),a.css({"text-indent":(c?"-":"")+"50px"},"fast").animate({"text-indent":"0"},"fast")})},tl.pg.PageGuide.prototype.pop_welcome=function(){a("body").addClass("tlyPageGuideWelcomeOpen"),this.track_event("PG.welcomeShown")},tl.pg.PageGuide.prototype.close_welcome=function(){a("body").removeClass("tlyPageGuideWelcomeOpen")}}(jQuery);